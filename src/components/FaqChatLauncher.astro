---
/**
 * 右下の「よくある質問」ボタン＋FAQチャット iframe ラウンチャー
 * - FAQチャットURLは固定で https://juku-faq.vercel.app/ を使用
 * - ボタン → iframe の開閉はこのコンポーネント内の <script> で完結
 */

const faqChatUrl = 'https://juku-faq.vercel.app/';
---

<div
  class="fixed inset-x-0 bottom-0 z-50 flex flex-col items-stretch sm:items-end px-2 sm:px-0 sm:pb-20 pointer-events-none"
>
  <!-- チャット本体（iframe） -->
  <div
    id="faq-chat-iframe-wrapper"
    class="w-full h-[min(100vh-4rem,720px)] sm:w-[min(100vw-2rem,420px)] sm:h-[min(70vh,560px)] rounded-t-3xl sm:rounded-2xl shadow-2xl border border-slate-200 bg-white overflow-hidden transition-all duration-200 ease-out translate-y-2 opacity-0 pointer-events-none"
    aria-hidden="true"
  >
    <iframe src={faqChatUrl} title="さとう数理塾 よくある質問チャット" class="w-full h-full border-0" loading="lazy"
    ></iframe>
  </div>
</div>

<!-- 起動ボタン（右下固定） -->
<button
  id="faq-chat-toggle"
  type="button"
  class="fixed bottom-6 right-6 z-50 flex items-center gap-2 px-4 py-3 rounded-full bg-white border-2 border-[#009DE0] text-[#009DE0] font-bold text-sm sm:text-base shadow-lg hover:bg-[#F0F7FF] hover:shadow-xl hover:-translate-y-0.5 transition-all duration-200 pointer-events-auto"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    class="w-5 h-5"
    aria-hidden="true"
  >
    <path
      fill="currentColor"
      d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"
    />
  </svg>
  <span class="whitespace-nowrap">よくある質問</span>
</button>

<script>
  // 右下ボタン → iframe の開閉を制御
  if (typeof window !== 'undefined') {
    const toggle = document.getElementById('faq-chat-toggle');
    const wrapper = document.getElementById('faq-chat-iframe-wrapper');

    if (toggle && wrapper) {
      let isOpen = false;

      const applyState = () => {
        if (isOpen) {
          wrapper.classList.remove('opacity-0', 'translate-y-2', 'pointer-events-none');
          wrapper.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
          wrapper.removeAttribute('aria-hidden');
        } else {
          wrapper.classList.add('opacity-0', 'translate-y-2', 'pointer-events-none');
          wrapper.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
          wrapper.setAttribute('aria-hidden', 'true');
        }
      };

      // 初期状態は閉じる
      applyState();

      toggle.addEventListener('click', () => {
        isOpen = !isOpen;
        applyState();
      });
    }
  }
</script>
